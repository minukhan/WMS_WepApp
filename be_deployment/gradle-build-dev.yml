stages:
  - build

build_app:
  stage: build
  image: gradle:7.6-jdk17
  script:
    - chmod +x ./gradlew          # ì‹¤í–‰ ê¶Œí•œ ì¶”ê°€
    - |
      echo "Creating application.yml from variable..."
      mkdir -p ./src/main/resources
      if [[ "$CI_COMMIT_BRANCH" == "dev" ]]; then
        echo "$APPLICATION_YML" > ./src/main/resources/application.yml
      elif [[ "$CI_COMMIT_BRANCH" == "main" ]]; then
        echo "$APPLICATION_YML_PROD" > ./src/main/resources/application.yml
      else
        echo "ğŸš« No matching branch for application.yml!"
        exit 1
      fi
    - ./gradlew clean build -x test  # Gradle ë¹Œë“œ ëª…ë ¹ ì‹¤í–‰
  artifacts:
    paths:
      - build/libs/*.jar          # ë¹Œë“œ ê²°ê³¼ë¬¼ ê²½ë¡œ (Gradle ê¸°ì¤€)
    expire_in: 1 hour             # ì•„í‹°íŒ©íŠ¸ ìœ íš¨ ê¸°ê°„ (ì„ íƒ)
  only:
    - dev
    - main
